!function(a,b,c,d){function e(b,c,d){this.element=b,this.options=a.extend({},g,c),this.dictionary=a.extend({},{},d),this._defaults=g,this._name=f,this.helper=null,this.init()}var f="asciimoji",g={prefix:"(",suffix:")"},h={background:"white",border:"1px solid lightgray","box-shadow":"0 1px 2px 0px rgba(0,0,0,.25)","box-sizing":"border-box",font:'1em "Helvetica Neue", Arial',"max-height":"200px","overflow-y":"auto",padding:"5px",position:"absolute","text-align":"left","z-index":"100000"},i="active",j={background:"#eeeeee"},k={background:"transparent"};e.prototype={getCaret:function(a){var b=a.get(0);if(b){if("selectionStart"in b)return b.selectionStart;if(c.selection){b.focus();var d=c.selection.createRange(),e=c.selection.createRange().text.length;return d.moveStart("character",-b.value.length),d.text.length-e}}},setCaret:function(a,c){var d=a.get(0);if(null!==d)if(d.createTextRange){var e=d.createTextRange();e.move("character",c),e.select()}else d.selectionStart?(d.focus(),b.setTimeout(function(){d.setSelectionRange(c,c)},0)):d.focus()},lastDiff:function(a,b){for(var c,d,e=Math.min(a.length,b.length),f=e,g=1;e>=g;g++)if(c=a.charAt(a.length-g),d=b.charAt(b.length-g),c!=d){f=b.length-g+1;break}return")"===b[f]&&f++,f},walkTheDom:function l(a,b){for(b(a),a=a.firstChild;a;)l(a,b),a=a.nextSibling},createHelper:function(){this.destroyHelper();var b=this,c=d(),e={};for(var f in c)for(var g=c[f].words,i=c[f].ascii,j=0;j<g.length;++j)e[g[j]]=i;var k="<table>";for(f in e){var l=e[f];"function"==typeof e[f]&&(l=e[f]()),k+='<tr data-word="'+f+'" style="height:40px"><td style="padding:5px 10px;border-radius:5px 0 0 5px">'+f+'</td><td style="padding:5px 10px;border-radius:0 5px 5px 0">'+l+"</td></tr>"}k+="</table>",k=a(k).css({border:"none",padding:0,"border-collapse":"collapse",width:"100%"}),this.helper=a('<div id="asciimoji-helper"></div>'),this.helper.css(h),this.helper.html(k),a("body").append(this.helper),a(this.element).on("keydown",function(c){var d=this.tagName.toLowerCase();if("textarea"==d){var e=Measurement.caretPos(this);b.helper.css({top:e.top+50+"px"})}switch(c.keyCode){case 40:c.preventDefault(),b.helperArrowDown();break;case 38:c.preventDefault(),b.helperArrowUp();break;case 27:b.hideHelper();break;case 9:case 13:a("#asciimoji-helper").is(":visible")&&(c.preventDefault(),b.insertWord())}})},showHelper:function(a){if(null===this.helper&&this.createHelper(),a.length<1)return void this.hideHelper();var b=this.element.tagName.toLowerCase(),c=this.element.getBoundingClientRect();if("input"==b)this.helper.css({top:c.bottom+"px",left:c.left+"px","min-width":c.width+"px"});else if("textarea"==b){var d=Measurement.caretPos(this.element);this.helper.css({top:d.top+50+"px",left:c.left+"px","min-width":c.width+"px"})}this.helper.find("tr").removeClass("visible").removeClass(i).css(k).css("display","none");var e=this.helper.find("td:contains("+a.toLowerCase()+")").parents("tr");0===e.length?this.hideHelper():(e.addClass("visible").css("display","table-row"),e.last().addClass(i).css(j),this.helper.show())},hideHelper:function(){a("#asciimoji-helper").hide()},destroyHelper:function(){a("#asciimoji-helper").remove(),this.helper=null,a("#_dummy").remove()},toggleHelper:function(a){var b=a.lastIndexOf(this.options.prefix),c=a.lastIndexOf(this.options.suffix);if(b>c){var d=a.length-b,e=a.substr(b+1,d);this.showHelper(e)}else c>b&&this.hideHelper()},helperArrowUp:function(){var b=this.helper.find("tr.visible"),c=!1;b.each(function(d,e){c===!1&&a(e).hasClass(i)&&(a(e).removeClass(i).css(k),c=d-1,d>0&&b.eq(c).addClass(i).css(j))}),activeRows=this.helper.find("tr."+i),0===activeRows.length&&b.last().addClass(i).css(j),this.helperShowActiveTerm()},helperArrowDown:function(){var b=this.helper.find("tr.visible"),c=!1;b.each(function(b,d){c===!1?a(d).hasClass(i)&&(a(d).removeClass(i).css(k),c=b+1):b===c&&a(d).addClass(i).css(j)}),activeRows=this.helper.find("tr."+i),0===activeRows.length&&b.first().addClass(i).css(j),this.helperShowActiveTerm()},helperShowActiveTerm:function(){a("tr."+i)[0].scrollIntoView();var b=this.helper.scrollTop()-7;this.helper.scrollTop(b)},insertWord:function(){var b=this.helper.find("tr."+i).first().attr("data-word"),c=a(this.element),d=c.val(),e=d.lastIndexOf(this.options.prefix),f=d.substr(0,e+1)+b+this.options.suffix;c.val(f).trigger("input"),this.hideHelper()},init:function(){var e,f,g,h=this,i=a(this.element),j=this.options,k=this.dictionary,l=i.prop("tagName").toLowerCase(),m="input paste",n="blur";switch(l){case"input":case"textarea":i.off(m).on(m,function(){e=i.val(),f=d(e,j,k),h.toggleHelper(e),e!=f&&(i.empty().val(f),g=h.lastDiff(e,f),h.setCaret(i,g))}),i.off(n).on(n,function(){h.destroyHelper()});break;default:i.data({watch_timer:setInterval(function(){var a=i.get(0);h.walkTheDom(a,function(a){if(3==a.nodeType&&(e=a.nodeValue,f=d(e,j,k),h.toggleHelper(e),e!=f))if(a.nodeValue=f,g=h.lastDiff(e,f),"undefined"!=typeof b.getSelection&&"undefined"!=typeof c.createRange){var i=c.createRange();i.setStart(a,g),i.setEnd(a,g);var l=b.getSelection();l.removeAllRanges(),l.addRange(i)}else if("undefined"!=typeof c.body.createTextRange){var m=c.body.createTextRange();m.moveToElementText(a),m.moveStart("character",g),m.moveEnd("character",g),m.select()}})},100)})}}},a.fn[f]=function(b,c){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b,c))})}}(jQuery,window,document,asciimoji);