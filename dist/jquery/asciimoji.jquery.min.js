!function(a,b,c,d){function e(b,c,d){this.element=b,this.options=a.extend({},g,c),this.dictionary=a.extend({},{},d),this._defaults=g,this._name=f,this.helper=null,this.init()}var f="asciimoji",g={prefix:"(",suffix:")"};e.prototype={getCaret:function(a){var b=a.get(0);if(b){if("selectionStart"in b)return b.selectionStart;if(c.selection){b.focus();var d=c.selection.createRange(),e=c.selection.createRange().text.length;return d.moveStart("character",-b.value.length),d.text.length-e}}},setCaret:function(a,c){var d=a.get(0);if(null!==d)if(d.createTextRange){var e=d.createTextRange();e.move("character",c),e.select()}else d.selectionStart?(d.focus(),b.setTimeout(function(){d.setSelectionRange(c,c)},0)):d.focus()},lastDiff:function(a,b){for(var c,d,e=Math.min(a.length,b.length),f=e,g=1;e>=g;g++)if(c=a.charAt(a.length-g),d=b.charAt(b.length-g),c!=d){f=b.length-g+1;break}return")"===b[f]&&f++,f},walkTheDom:function h(a,b){for(b(a),a=a.firstChild;a;)h(a,b),a=a.nextSibling},createHelper:function(){var b=d(),c={};for(var e in b)for(var f=b[e].words,g=b[e].ascii,h=0;h<f.length;++h)c[f[h]]=g;var i="<ul>";for(e in c)i+="<li><strong>"+e+"</strong><label>"+c[e]+"</label></li>";i+="</ul>",this.helper=a('<div id="asciimoji-helper"></div>'),this.helper.css({background:"aliceblue",border:"1px solid lightblue",height:"90px",overflowY:"auto",padding:"5px",position:"absolute",textAlign:"left"}),this.helper.html(i),a("body").append(this.helper)},showHelper:function(){null===this.helper&&this.createHelper();var a=this.element.getBoundingClientRect();this.helper.css({top:a.left+"px",left:a.bottom+"px",width:a.width+"px"}).show()},hideHelper:function(){a("#asciimoji-helper").hide()},toggleHelper:function(a){var b=a.lastIndexOf(this.options.prefix),c=a.lastIndexOf(this.options.suffix);b>c?this.showHelper():c>b&&this.hideHelper()},init:function(){var e,f,g,h=this,i=a(this.element),j=this.options,k=this.dictionary,l=i.prop("tagName").toLowerCase(),m="input paste",n="blur";switch(l){case"input":case"textarea":i.off(m).on(m,function(){e=i.val(),f=d(e,j,k),h.toggleHelper(e),e!=f&&(i.empty().val(f),g=h.lastDiff(e,f),h.setCaret(i,g))}),i.off(n).on(n,function(){h.hideHelper()});break;default:i.data({watch_timer:setInterval(function(){var a=i.get(0);h.walkTheDom(a,function(a){if(3==a.nodeType&&(e=a.nodeValue,f=d(e,j,k),h.toggleHelper(e),e!=f))if(a.nodeValue=f,g=h.lastDiff(e,f),"undefined"!=typeof b.getSelection&&"undefined"!=typeof c.createRange){var i=c.createRange();i.setStart(a,g),i.setEnd(a,g);var l=b.getSelection();l.removeAllRanges(),l.addRange(i)}else if("undefined"!=typeof c.body.createTextRange){var m=c.body.createTextRange();m.moveToElementText(a),m.moveStart("character",g),m.moveEnd("character",g),m.select()}})},100)})}}},a.fn[f]=function(b,c){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b,c))})}}(jQuery,window,document,asciimoji);