!function(a,b,c,d){function e(b,c,d){this.element=b,this.options=a.extend({},g,c),this.dictionary=a.extend({},{},d),this._defaults=g,this._name=f,this.helper=null,this.init()}var f="asciimoji",g={prefix:"(",suffix:")"},h="asciimoji-active";e.prototype={getCaret:function(a){var b=a.get(0);if(b){if("selectionStart"in b)return b.selectionStart;if(c.selection){b.focus();var d=c.selection.createRange(),e=c.selection.createRange().text.length;return d.moveStart("character",-b.value.length),d.text.length-e}}},setCaret:function(a,c){var d=a.get(0);if(null!==d)if(d.createTextRange){var e=d.createTextRange();e.move("character",c),e.select()}else d.selectionStart?(d.focus(),b.setTimeout(function(){d.setSelectionRange(c,c)},0)):d.focus()},lastDiff:function(a,b){for(var c,d,e=Math.min(a.length,b.length),f=e,g=1;e>=g;g++)if(c=a.charAt(a.length-g),d=b.charAt(b.length-g),c!=d){f=b.length-g+1;break}return")"===b[f]&&f++,f},walkTheDom:function i(a,b){for(b(a),a=a.firstChild;a;)i(a,b),a=a.nextSibling},createHelper:function(){var b=this,c=a("<style></style>"),e="."+h+" { background: lightblue }";c.html(e),a("head").append(c);var f=d(),g={};for(var i in f)for(var j=f[i].words,k=f[i].ascii,l=0;l<j.length;++l)g[j[l]]=k;var m="<table>";for(i in g){var n=g[i];"function"==typeof g[i]&&(n=g[i]()),m+='<tr data-word="'+i+'"><td>'+i+"</td><td>"+n+"</td></tr>"}m+="</table>",m=a(m).css({border:"none",padding:0,"border-collapse":"collapse",width:"100%"}),this.helper=a('<div id="asciimoji-helper"></div>'),this.helper.css({background:"aliceblue",border:"1px solid lightblue","max-height":"200px","overflow-y":"auto",padding:"5px",position:"absolute","text-align":"left"}),this.helper.html(m),a("body").append(this.helper),a(this.element).on("keydown",function(a){switch(a.keyCode){case 40:b.helperArrowDown();break;case 38:b.helperArrowUp();break;case 27:b.hideHelper();break;case 13:b.insertWord()}})},showHelper:function(a){if(null===this.helper&&this.createHelper(),a.length<1)return void this.hideHelper();var b=this.element.getBoundingClientRect();this.helper.css({top:b.left+"px",left:b.bottom+"px",width:b.width+"px"}),this.helper.find("tr").removeClass("visible").css("display","none").removeClass(h);var c=this.helper.find("td:contains("+a.toLowerCase()+")").parents("tr");0===c.length?this.hideHelper():(c.addClass("visible").css("display","table-row"),c.last().addClass(h),this.helper.show())},hideHelper:function(){a("#asciimoji-helper").hide()},toggleHelper:function(a){var b=a.lastIndexOf(this.options.prefix),c=a.lastIndexOf(this.options.suffix);if(b>c){var d=a.length-b,e=a.substr(b+1,d);this.showHelper(e)}else c>b&&this.hideHelper()},helperArrowUp:function(){var b=this.helper.find("tr.visible"),c=!1;b.each(function(d,e){c===!1&&a(e).hasClass(h)&&(a(e).removeClass(h),c=d-1,d>0&&b.eq(c).addClass(h))}),activeRows=this.helper.find("tr."+h),0===activeRows.length&&b.last().addClass(h),a("tr."+h)[0].scrollIntoView()},helperArrowDown:function(){var b=this.helper.find("tr.visible"),c=!1;b.each(function(b,d){c===!1?a(d).hasClass(h)&&(a(d).removeClass(h),c=b+1):b===c&&a(d).addClass(h)}),activeRows=this.helper.find("tr."+h),0===activeRows.length&&b.first().addClass(h),a("tr."+h)[0].scrollIntoView()},insertWord:function(){var b=this.helper.find("tr."+h).first().attr("data-word"),c=a(this.element),d=c.val(),e=d.lastIndexOf(this.options.prefix),f=d.substr(0,e+1)+b+this.options.suffix;c.val(f).trigger("input"),this.hideHelper()},init:function(){var e,f,g,h=this,i=a(this.element),j=this.options,k=this.dictionary,l=i.prop("tagName").toLowerCase(),m="input paste",n="chickenwings";switch(l){case"input":case"textarea":i.off(m).on(m,function(){e=i.val(),f=d(e,j,k),h.toggleHelper(e),e!=f&&(i.empty().val(f),g=h.lastDiff(e,f),h.setCaret(i,g))}),i.off(n).on(n,function(){h.hideHelper()});break;default:i.data({watch_timer:setInterval(function(){var a=i.get(0);h.walkTheDom(a,function(a){if(3==a.nodeType&&(e=a.nodeValue,f=d(e,j,k),h.toggleHelper(e),e!=f))if(a.nodeValue=f,g=h.lastDiff(e,f),"undefined"!=typeof b.getSelection&&"undefined"!=typeof c.createRange){var i=c.createRange();i.setStart(a,g),i.setEnd(a,g);var l=b.getSelection();l.removeAllRanges(),l.addRange(i)}else if("undefined"!=typeof c.body.createTextRange){var m=c.body.createTextRange();m.moveToElementText(a),m.moveStart("character",g),m.moveEnd("character",g),m.select()}})},100)})}}},a.fn[f]=function(b,c){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b,c))})}}(jQuery,window,document,asciimoji);